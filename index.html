<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#DDE6FF">
    <title>Light the Cracker Within - Diwali 2024</title>
    
    <!-- Preload critical images -->
    <link rel="preload" as="image" href="https://framerusercontent.com/images/otpXuKdG3uW4Up8ICaqstwvlg4o.png?scale-down-to=512">
    <link rel="preload" as="image" href="https://i.imgur.com/tFONffe.png">
    <link rel="preload" as="image" href="https://i.imgur.com/NfuocXK.png">
    <link rel="preload" as="image" href="https://i.imgur.com/kAOYFVM.png">
    <link rel="preload" as="image" href="https://i.imgur.com/xA3gnAQ.png">
    <link rel="preload" as="image" href="https://i.imgur.com/NY5QUQs.png">
    <link rel="preload" as="image" href="https://i.imgur.com/hIuZMOj.png">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html {
            font-size: 16px;
            -webkit-text-size-adjust: 100%;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #DDE6FF 0%, #ffffff 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow-x: hidden;
            touch-action: manipulation;
        }

        .container {
            max-width: 700px;
            width: 100%;
        }

        .card {
            background: white;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            padding: 40px;
            text-align: center;
            position: relative;
        }

        .logo {
            width: 140px;
            height: 140px;
            margin: 0 auto 20px;
        }

        .logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .firework-decoration {
            font-size: 60px;
            margin-bottom: 12px;
            animation: sparkleRotate 3s ease-in-out infinite;
        }

        @keyframes sparkleRotate {
            0%, 100% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(10deg) scale(1.1); }
        }

        h1 {
            color: #32509F;
            font-size: 42px;
            font-weight: bold;
            margin-bottom: 28px;
            line-height: 1.2;
        }

        h1.orange-title {
            color: #F77F00;
        }

        h2 {
            color: #32509F;
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 20px;
            line-height: 1.3;
        }

        .cracker-progress-container {
            position: relative;
            margin-bottom: 40px;
            padding: 0 20px;
        }

        .fuse-line {
            width: 100%;
            height: 8px;
            background: linear-gradient(90deg, #8B4513 0%, #654321 100%);
            border-radius: 4px;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 100px;
        }

        .fuse-spark {
            position: absolute;
            left: 0;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 28px;
            height: 28px;
            transition: left 0.5s ease;
        }

        .spark-flame {
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, #FFD700 0%, #FF6B00 30%, #FF0000 60%, transparent 80%);
            border-radius: 50%;
            animation: flicker 0.15s infinite alternate;
            filter: blur(1px);
        }

        .spark-core {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 10px;
            height: 10px;
            background: #FFFFFF;
            border-radius: 50%;
            box-shadow: 0 0 10px #FFD700, 0 0 20px #FF6B00;
        }

        @keyframes flicker {
            0% { transform: scale(1) rotate(0deg); opacity: 0.9; }
            100% { transform: scale(1.4) rotate(15deg); opacity: 1; }
        }

        .cone-cracker {
            position: absolute;
            right: -60px;
            top: -25px;
            filter: drop-shadow(3px 3px 6px rgba(0,0,0,0.2));
        }

        .cracker-display {
            margin: 35px 0;
            position: relative;
        }

        .sweet-image {
            width: 260px;
            height: 260px;
            margin: 20px auto;
            object-fit: contain;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.1));
        }

        .sparkle {
            position: fixed;
            pointer-events: none;
            z-index: 9999;
        }

        .sparkle-line {
            position: absolute;
            width: 40px;
            height: 3px;
            border-radius: 2px;
            transform-origin: center;
        }

        @keyframes sparkle-shoot {
            0% {
                opacity: 1;
                transform: translate(0, 0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(var(--tx), var(--ty)) scale(0.3);
            }
        }

        .star-sparkle {
            position: fixed;
            pointer-events: none;
            z-index: 9999;
            font-size: 24px;
        }

        @keyframes star-float {
            0% {
                opacity: 1;
                transform: translate(0, 0) rotate(0deg) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(var(--tx), var(--ty)) rotate(360deg) scale(0.5);
            }
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            z-index: 9998;
            pointer-events: none;
        }

        @keyframes confetti-fall {
            to {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        .blast-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.3);
            z-index: 9997;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .blast-container {
            position: relative;
            z-index: 9998;
        }

        .blast-screen {
            font-size: 140px;
            animation: blastPulse 0.5s infinite;
            text-shadow: 0 0 40px rgba(255, 107, 0, 0.8);
        }

        @keyframes blastPulse {
            0%, 100% { transform: scale(1) rotate(-5deg); }
            50% { transform: scale(1.4) rotate(5deg); }
        }

        .blast-wave {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 80px;
            border: 3px solid #F77F00;
            border-radius: 50%;
            animation: blast-wave 1s ease-out infinite;
        }

        @keyframes blast-wave {
            0% {
                width: 80px;
                height: 80px;
                opacity: 1;
            }
            100% {
                width: 400px;
                height: 400px;
                opacity: 0;
            }
        }

        input[type="text"] {
            width: 100%;
            padding: 18px 24px;
            border: 2px solid #32509F;
            border-radius: 12px;
            font-size: 18px;
            text-align: center;
            color: #32509F;
            margin-bottom: 20px;
            outline: none;
            transition: all 0.3s;
        }

        input[type="text"]:focus {
            border-color: #F77F00;
            box-shadow: 0 0 0 3px rgba(247, 127, 0, 0.1);
        }

        input.error {
            border-color: #DC2626;
        }

        .error-text {
            color: #DC2626;
            font-size: 15px;
            margin-top: -12px;
            margin-bottom: 20px;
        }

        button {
            background: #F77F00;
            color: white;
            border: none;
            padding: 18px 32px;
            border-radius: 12px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(247, 127, 0, 0.3);
            touch-action: manipulation;
        }

        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(247, 127, 0, 0.4);
        }

        button:active:not(:disabled) {
            transform: translateY(0);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: white;
            color: #32509F;
            border: 2px solid #32509F;
            margin-top: 12px;
            box-shadow: none;
        }

        .btn-primary {
            background: #32509F;
            box-shadow: 0 4px 12px rgba(50, 80, 159, 0.3);
        }

        .btn-back {
            background: white;
            color: #F77F00;
            border: 2px solid #F77F00;
            margin-top: 12px;
            font-size: 17px;
            padding: 14px 28px;
            box-shadow: none;
        }

        .options {
            display: grid;
            gap: 14px;
            margin: 28px 0;
        }

        .option-btn {
            background: white;
            border: 2px solid #32509F;
            color: #32509F;
            padding: 18px;
            border-radius: 14px;
            font-size: 17px;
            text-align: left;
            transition: all 0.3s;
            cursor: pointer;
            line-height: 1.5;
        }

        .option-btn:hover {
            background: #DDE6FF;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(50, 80, 159, 0.2);
        }

        .option-btn:active {
            transform: translateY(0);
        }

        .question-counter {
            color: #F77F00;
            font-size: 15px;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .result-card {
            max-width: 800px;
        }

        .result-title {
            font-size: 44px;
            color: #F77F00;
            font-weight: bold;
            margin: 20px 0;
        }

        .result-subtitle {
            font-size: 26px;
            color: #32509F;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .result-message {
            font-size: 22px;
            color: #32509F;
            font-weight: 500;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .custom-line {
            font-size: 18px;
            color: #4B5563;
            margin: 12px 0;
            line-height: 1.6;
        }

        .footer-message {
            font-size: 20px;
            color: #32509F;
            font-weight: 600;
            font-style: italic;
            margin-top: 28px;
            padding-top: 28px;
            border-top: 2px solid #DDE6FF;
        }

        .button-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 14px;
            margin-top: 28px;
        }

        .disclaimer-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
            padding: 20px;
        }

        .disclaimer-overlay.show {
            opacity: 1;
        }

        .disclaimer-overlay.hide {
            opacity: 0;
        }

        .disclaimer-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 100%;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .disclaimer-overlay.show .disclaimer-card {
            transform: scale(1);
        }

        .hidden {
            display: none !important;
        }

        .loading-spinner {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            color: white;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top-color: #F77F00;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Mobile Responsive - Optimized for all devices */
        @media (max-width: 768px) {
            html {
                font-size: 18px;
            }
            
            body {
                padding: 16px 12px;
            }
            
            .card {
                padding: 32px 24px;
                border-radius: 20px;
            }
            
            .logo {
                width: 120px;
                height: 120px;
            }
            
            .firework-decoration {
                font-size: 52px;
            }
            
            h1 {
                font-size: 36px;
                margin-bottom: 24px;
                line-height: 1.2;
            }
            
            h2 {
                font-size: 26px;
                line-height: 1.4;
                margin-bottom: 20px;
            }
            
            .result-title {
                font-size: 40px;
                margin: 16px 0;
            }
            
            .result-subtitle {
                font-size: 24px;
                margin-bottom: 16px;
            }
            
            .result-message {
                font-size: 20px;
                line-height: 1.6;
            }
            
            .custom-line {
                font-size: 17px;
                line-height: 1.7;
            }
            
            .footer-message {
                font-size: 19px;
                margin-top: 24px;
                padding-top: 24px;
            }
            
            .button-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .sweet-image {
                width: 240px;
                height: 240px;
                margin: 20px auto;
            }
            
            .cracker-progress-container {
                padding: 0 16px;
                margin-bottom: 36px;
            }
            
            .fuse-line {
                height: 8px;
                margin-bottom: 90px;
            }
            
            .cone-cracker {
                right: -55px;
                top: -22px;
            }
            
            .blast-screen {
                font-size: 120px;
            }
            
            .option-btn {
                font-size: 17px;
                padding: 18px 16px;
                line-height: 1.5;
            }
            
            button {
                font-size: 19px;
                padding: 18px 32px;
                border-radius: 14px;
            }
            
            input[type="text"] {
                font-size: 18px;
                padding: 18px 24px;
            }
            
            .disclaimer-card {
                padding: 32px 24px;
            }
            
            .disclaimer-card h2 {
                font-size: 26px;
            }
            
            .disclaimer-card p {
                font-size: 17px;
            }
        }

        @media (max-width: 480px) {
            html {
                font-size: 17px;
            }
            
            .card {
                padding: 28px 20px;
            }
            
            h1 {
                font-size: 32px;
            }
            
            h2 {
                font-size: 24px;
            }
            
            .result-title {
                font-size: 36px;
            }
            
            .sweet-image {
                width: 220px;
                height: 220px;
            }
            
            .logo {
                width: 110px;
                height: 110px;
            }
        }

        @media (max-width: 380px) {
            html {
                font-size: 16px;
            }
            
            h1 {
                font-size: 28px;
            }
            
            .result-title {
                font-size: 32px;
            }
            
            .sweet-image {
                width: 200px;
                height: 200px;
            }
            
            .cone-cracker {
                right: -45px;
                transform: scale(0.85);
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Preload images */
        .preload-images {
            position: absolute;
            width: 1px;
            height: 1px;
            overflow: hidden;
            opacity: 0;
            pointer-events: none;
        }
    </style>
</head>
<body>

    <!-- Preload sweet images -->
    <div class="preload-images">
        <img src="https://i.imgur.com/tFONffe.png" alt="preload">
        <img src="https://i.imgur.com/NfuocXK.png" alt="preload">
        <img src="https://i.imgur.com/kAOYFVM.png" alt="preload">
        <img src="https://i.imgur.com/xA3gnAQ.png" alt="preload">
        <img src="https://i.imgur.com/NY5QUQs.png" alt="preload">
        <img src="https://i.imgur.com/hIuZMOj.png" alt="preload">
    </div>

    <!-- Disclaimer Overlay -->
    <div id="disclaimer" class="disclaimer-overlay hidden">
        <div class="disclaimer-card">
            <div style="font-size: 72px; margin-bottom: 20px;">🎆</div>
            <h2>Cracker lit!</h2>
            <p style="font-size: 18px; color: #4B5563; margin: 20px 0; line-height: 1.6;">
                Give 5 quick responses to blast the <strong>Flower-pot!</strong>
            </p>
            <p style="font-size: 18px; color: #4B5563; margin: 20px 0; line-height: 1.6;">
                Your responses are <strong>NOT stored anywhere</strong> — answer honestly for the best blast.
            </p>
        </div>
    </div>

    <!-- Landing Screen -->
    <div id="landing" class="container">
        <div class="cracker-progress-container">
            <div class="fuse-line">
                <div class="fuse-spark" style="left: 0%;">
                    <div class="spark-flame"></div>
                    <div class="spark-core"></div>
                </div>
            </div>
            <div class="cone-cracker">
                <svg width="120" height="140" viewBox="0 0 120 140">
                    <defs>
                        <linearGradient id="stripeRed" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#8B1538;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#6B0F2A;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="stripeYellow" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#FFD700;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#FFA500;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <path d="M 60 20 L 30 120 L 90 120 Z" fill="#8B1538"/>
                    <path d="M 60 20 L 35 95 L 85 95 L 84 100 L 36 100 L 30 120 L 90 120 L 60 20 Z" fill="url(#stripeYellow)"/>
                    <path d="M 60 20 L 40 75 L 80 75 L 79 80 L 41 80 L 35 95 L 85 95 L 60 20 Z" fill="url(#stripeRed)"/>
                    <path d="M 60 20 L 45 55 L 75 55 L 74 60 L 46 60 L 40 75 L 80 75 L 60 20 Z" fill="url(#stripeYellow)"/>
                    <path d="M 60 20 L 50 35 L 70 35 L 69 40 L 51 40 L 45 55 L 75 55 L 60 20 Z" fill="url(#stripeRed)"/>
                    <polygon points="30,120 90,120 85,125 35,125" fill="#FFA500"/>
                    <line x1="60" y1="20" x2="60" y2="5" stroke="#654321" stroke-width="3" stroke-linecap="round"/>
                    <circle cx="60" cy="5" r="4" fill="#FF6B00">
                        <animate attributeName="r" values="4;6;4" dur="0.4s" repeatCount="indefinite"/>
                    </circle>
                </svg>
            </div>
        </div>
        
        <div class="card">
            <div class="logo">
                <img src="https://framerusercontent.com/images/otpXuKdG3uW4Up8ICaqstwvlg4o.png?scale-down-to=512" alt="Make Eazy">
            </div>
            <div class="firework-decoration">🎆</div>
            <h1>Light the Cracker Within! 🎇</h1>
            
            <div class="cracker-display">
                <svg width="140" height="160" viewBox="0 0 120 140">
                    <path d="M 60 20 L 30 120 L 90 120 Z" fill="#8B1538"/>
                    <path d="M 60 20 L 35 95 L 85 95 L 84 100 L 36 100 L 30 120 L 90 120 L 60 20 Z" fill="url(#stripeYellow)"/>
                    <path d="M 60 20 L 40 75 L 80 75 L 79 80 L 41 80 L 35 95 L 85 95 L 60 20 Z" fill="url(#stripeRed)"/>
                    <path d="M 60 20 L 45 55 L 75 55 L 74 60 L 46 60 L 40 75 L 80 75 L 60 20 Z" fill="url(#stripeYellow)"/>
                    <path d="M 60 20 L 50 35 L 70 35 L 69 40 L 51 40 L 45 55 L 75 55 L 60 20 Z" fill="url(#stripeRed)"/>
                    <polygon points="30,120 90,120 85,125 35,125" fill="#FFA500"/>
                    <line x1="60" y1="20" x2="60" y2="5" stroke="#654321" stroke-width="3" stroke-linecap="round"/>
                    <circle cx="60" cy="5" r="4" fill="#FF6B00">
                        <animate attributeName="r" values="4;6;4" dur="0.4s" repeatCount="indefinite"/>
                    </circle>
                </svg>
            </div>

            <input type="text" id="nameInput" placeholder="Enter your name" maxlength="30">
            <div id="nameError" class="error-text hidden"></div>
            <button id="startBtn" onclick="handleStart()">Light It! 🔥</button>
        </div>
    </div>

    <!-- Questions Screen -->
    <div id="questions" class="container hidden">
        <div class="cracker-progress-container">
            <div class="fuse-line">
                <div id="questionSpark" class="fuse-spark" style="left: 0%;">
                    <div class="spark-flame"></div>
                    <div class="spark-core"></div>
                </div>
            </div>
            <div class="cone-cracker">
                <svg width="120" height="140" viewBox="0 0 120 140">
                    <defs>
                        <linearGradient id="stripeRed2" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#8B1538;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#6B0F2A;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="stripeYellow2" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#FFD700;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#FFA500;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <path d="M 60 20 L 30 120 L 90 120 Z" fill="#8B1538"/>
                    <path d="M 60 20 L 35 95 L 85 95 L 84 100 L 36 100 L 30 120 L 90 120 L 60 20 Z" fill="url(#stripeYellow2)"/>
                    <path d="M 60 20 L 40 75 L 80 75 L 79 80 L 41 80 L 35 95 L 85 95 L 60 20 Z" fill="url(#stripeRed2)"/>
                    <path d="M 60 20 L 45 55 L 75 55 L 74 60 L 46 60 L 40 75 L 80 75 L 60 20 Z" fill="url(#stripeYellow2)"/>
                    <path d="M 60 20 L 50 35 L 70 35 L 69 40 L 51 40 L 45 55 L 75 55 L 60 20 Z" fill="url(#stripeRed2)"/>
                    <polygon points="30,120 90,120 85,125 35,125" fill="#FFA500"/>
                    <line x1="60" y1="20" x2="60" y2="5" stroke="#654321" stroke-width="3" stroke-linecap="round"/>
                    <circle cx="60" cy="5" r="4" fill="#FF6B00"/>
                </svg>
            </div>
        </div>
        
        <div class="card">
            <div id="questionCounter" class="question-counter"></div>
            <h2 id="questionText"></h2>
            <div id="optionsContainer" class="options"></div>
            <button id="backBtn" class="btn-back" onclick="goBackQuestion()" style="display: none;">
                ← Go Back & Change Answer
            </button>
        </div>
    </div>

    <!-- Blast Screen -->
    <div id="blast" class="blast-overlay hidden">
        <div class="blast-container">
            <div class="blast-screen">💥</div>
            <div class="blast-wave"></div>
            <div class="blast-wave" style="animation-delay: 0.2s;"></div>
            <div class="blast-wave" style="animation-delay: 0.4s;"></div>
        </div>
    </div>

    <!-- Result Card -->
    <div id="result" class="container hidden">
        <div class="card result-card" id="downloadCard">
            <div class="logo" style="margin: 0 auto 12px;">
                <img src="https://framerusercontent.com/images/otpXuKdG3uW4Up8ICaqstwvlg4o.png?scale-down-to=512" alt="Make Eazy" id="resultLogo">
            </div>
            <h1 class="orange-title" style="font-size: 38px; margin: 8px 0 4px 0;">Light the Cracker Within!</h1>
            <h1 style="font-size: 36px; margin: 4px 0 12px 0;">Happy Diwali! 🎆</h1>
            <h2 style="color: #F77F00; font-size: 36px; margin: 12px 0 20px 0;" id="userName"></h2>
            
            <img id="sweetImage" class="sweet-image" src="" alt="Sweet">
            
            <div class="result-title" id="resultSweet"></div>
            <div class="result-subtitle" id="resultTitle"></div>
            <p class="result-message" id="resultMessage"></p>
            <div id="customLines"></div>
            <div class="footer-message">
                Every sweet glows differently — so do you.
                <div style="margin-top: 20px; font-size: 15px; color: #F77F00; font-weight: bold;">Team Makeeazy</div>
            </div>
        </div>

        <div class="button-grid">
            <button class="btn-primary" onclick="downloadCard()">
                🔥 Download Card
            </button>
            <button onclick="shareThisGift()">
                🎁 Share this Gift
            </button>
        </div>

        <div class="button-grid" style="margin-top: 14px;">
            <button class="btn-back" onclick="retakeQuiz()" style="width: 100%; grid-column: 1 / -1;">
                🔄 Retake Quiz
            </button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        let userName = '';
        let answers = {};
        let currentQuestion = 0;
        let resultData = null;
        let cardImageBlob = null;

        const sweetImages = {
            jalebi: 'https://i.imgur.com/NY5QUQs.png',
            laddu: 'https://i.imgur.com/kAOYFVM.png',
            kaja: 'https://i.imgur.com/xA3gnAQ.png',
            gulab: 'https://i.imgur.com/hIuZMOj.png',
            pootharekulu: 'https://i.imgur.com/tFONffe.png',
            bobbatlu: 'https://i.imgur.com/NfuocXK.png'
        };

        // Preload all sweet images
        function preloadImages() {
            Object.values(sweetImages).forEach(src => {
                const img = new Image();
                img.crossOrigin = 'anonymous';
                img.src = src;
            });
        }
        preloadImages();

        const config = {
            sweets: {
                P: { 
                    name: 'Pootharekulu', 
                    title: 'The Calm Thinker', 
                    msg: 'Quiet outside, powerful inside. Slow glows last longest.',
                    image: sweetImages.pootharekulu
                },
                B: { 
                    name: 'Bobbatlu', 
                    title: 'The Warm Soul', 
                    msg: 'You comfort and restore. Save a slice of that warmth for yourself.',
                    image: sweetImages.bobbatlu
                },
                L: { 
                    name: 'Laddu', 
                    title: 'The Joy Giver', 
                    msg: 'You make messes feel festive. Your laughter is a light.',
                    image: sweetImages.laddu
                },
                K: { 
                    name: 'Kaja', 
                    title: 'The Achiever', 
                    msg: 'Crisp under pressure. You didn\'t break—you caramelized.',
                    image: sweetImages.kaja
                },
                J: { 
                    name: 'Jalebi', 
                    title: 'The Spirited One', 
                    msg: 'Twists, turns, still sweet. Your optimism is the plot twist.',
                    image: sweetImages.jalebi
                },
                G: { 
                    name: 'Gulab Jamun', 
                    title: 'The Soft Healer', 
                    msg: 'Soft isn\'t weak. Your kindness holds things together.',
                    image: sweetImages.gulab
                }
            },
            weights: { Q1: 1.5, Q2: 1, Q3: 1.5, Q4: 1, Q5: 1 },
            map: {
                Q1: { A: 'P', B: 'B', C: 'J', D: 'K' },
                Q2: { A: 'J', B: 'K', C: 'L', D: 'P' },
                Q3: { A: 'P', B: 'B', C: 'J', D: 'K' },
                Q4: { A: 'P', B: 'G', C: 'L', D: 'G' },
                Q5: { A: 'P', B: 'L', C: 'J', D: 'K' }
            },
            pairRules: [
                ['P', 'B', 'G'], ['L', 'J', 'J'], ['K', 'L', 'K'], ['K', 'P', 'K'],
                ['B', 'L', 'B'], ['P', 'J', 'P'], ['K', 'J', 'K'], ['G', 'P', 'G'], ['G', 'B', 'G']
            ],
            q5TieBreak: { A: 'P', B: 'L', C: 'J', D: 'K' }
        };

        const questions = [
            {
                q: 'How did you deal with chaos this year?',
                opts: [
                    { key: 'A', text: 'I turned into Buddha with Wi-Fi. 🧘‍♂️' },
                    { key: 'B', text: 'Fed people biryani till they calmed down. 🍛' },
                    { key: 'C', text: 'Laughed… then cried… then laughed again. 😂🥲' },
                    { key: 'D', text: 'I didn\'t deal, I managed — then jumped over it. 🧠' }
                ]
            },
            {
                q: 'How often did you actually take a break this year?',
                opts: [
                    { key: 'A', text: 'Break? Like… emotional or screen time? 😅' },
                    { key: 'B', text: 'Once, when Wi-Fi went off for 2 hours. ⚡' },
                    { key: 'C', text: 'Every weekend… mentally, not physically. 😌' },
                    { key: 'D', text: 'Every day — because I work smart, not hard. 💼' }
                ]
            },
            {
                q: 'Which line sums up your 2025 vibe?',
                opts: [
                    { key: 'A', text: 'I survived. That\'s the caption. 😶' },
                    { key: 'B', text: 'Still feeding people, still healing myself. 🍲' },
                    { key: 'C', text: 'Life\'s a mess, but it\'s my kinda mess. 💃' },
                    { key: 'D', text: 'Error 404: Life not found. 🧳' }
                ]
            },
            {
                q: 'What did you secretly crave the most this year?',
                opts: [
                    { key: 'A', text: 'Silence, peace, less notifications. 📵' },
                    { key: 'B', text: 'Someone who says, I got you. ❤️' },
                    { key: 'C', text: 'More laughter, less drama. 😂' },
                    { key: 'D', text: 'A break that doesn\'t involve guilt. 💤' }
                ]
            },
            {
                q: 'How do you hype yourself up when life drags you down?',
                opts: [
                    { key: 'A', text: 'It\'s okay, slow progress still counts. 🌙' },
                    { key: 'B', text: 'Eat, sleep, repeat confidence. 🍛' },
                    { key: 'C', text: 'Make a meme out of it, obviously. 🤳' },
                    { key: 'D', text: 'Stand up, fix hair, and pretend I\'ve got it together. 😎' }
                ]
            }
        ];

        function playRealisticFizz(intensity = 1) {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const bufferSize = audioContext.sampleRate * (0.3 + intensity * 0.4);
                const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
                const data = buffer.getChannelData(0);
                
                for (let i = 0; i < bufferSize; i++) {
                    data[i] = (Math.random() * 2 - 1) * 0.3 * intensity;
                }
                
                const source = audioContext.createBufferSource();
                source.buffer = buffer;
                
                const filter = audioContext.createBiquadFilter();
                filter.type = 'bandpass';
                filter.frequency.value = 2000 + (intensity * 2000);
                filter.Q.value = 1;
                
                const gainNode = audioContext.createGain();
                const volume = 0.2 * intensity;
                gainNode.gain.setValueAtTime(volume, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + (0.3 + intensity * 0.4));
                
                source.connect(filter);
                filter.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                source.start();
                source.stop(audioContext.currentTime + (0.3 + intensity * 0.4));
            } catch (error) {
                console.error('Fizz sound error:', error);
            }
        }

        function playRealisticBlast() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                const bufferSize = audioContext.sampleRate * 1.2;
                const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
                const data = buffer.getChannelData(0);
                
                for (let i = 0; i < bufferSize; i++) {
                    data[i] = (Math.random() * 2 - 1) * Math.exp(-i / bufferSize * 3);
                }
                
                const source = audioContext.createBufferSource();
                source.buffer = buffer;
                
                const filter = audioContext.createBiquadFilter();
                filter.type = 'lowpass';
                filter.frequency.value = 800;
                
                const gainNode = audioContext.createGain();
                gainNode.gain.setValueAtTime(0.6, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1.2);
                
                source.connect(filter);
                filter.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                source.start();
                
                const osc = audioContext.createOscillator();
                const oscGain = audioContext.createGain();
                osc.type = 'square';
                osc.frequency.setValueAtTime(3000, audioContext.currentTime);
                osc.frequency.exponentialRampToValueAtTime(100, audioContext.currentTime + 0.1);
                oscGain.gain.setValueAtTime(0.4, audioContext.currentTime);
                oscGain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.15);
                osc.connect(oscGain);
                oscGain.connect(audioContext.destination);
                osc.start();
                osc.stop(audioContext.currentTime + 0.15);
            } catch (error) {
                console.error('Blast sound error:', error);
            }
        }

        function createRealisticSparkles() {
            const colors = ['#FFD700', '#FFA500', '#FF6347', '#FF1493', '#4169E1', '#32CD32'];
            const stars = ['⭐', '✨', '💫', '🌟'];
            
            for (let i = 0; i < 30; i++) {
                setTimeout(() => {
                    const angle = (Math.PI * 2 * i) / 30;
                    const sparkle = document.createElement('div');
                    sparkle.className = 'sparkle';
                    sparkle.style.left = '50%';
                    sparkle.style.top = '50%';
                    
                    const line = document.createElement('div');
                    line.className = 'sparkle-line';
                    line.style.background = `linear-gradient(90deg, ${colors[i % colors.length]}, transparent)`;
                    line.style.transform = `rotate(${angle}rad)`;
                    line.style.setProperty('--tx', `${Math.cos(angle) * 300}px`);
                    line.style.setProperty('--ty', `${Math.sin(angle) * 300}px`);
                    line.style.animation = 'sparkle-shoot 1s ease-out forwards';
                    
                    sparkle.appendChild(line);
                    document.body.appendChild(sparkle);
                    
                    setTimeout(() => sparkle.remove(), 1000);
                }, i * 20);
            }
            
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const star = document.createElement('div');
                    star.className = 'star-sparkle';
                    star.textContent = stars[Math.floor(Math.random() * stars.length)];
                    star.style.left = '50%';
                    star.style.top = '50%';
                    star.style.color = colors[Math.floor(Math.random() * colors.length)];
                    const angle = Math.random() * Math.PI * 2;
                    const distance = 200 + Math.random() * 200;
                    star.style.setProperty('--tx', `${Math.cos(angle) * distance}px`);
                    star.style.setProperty('--ty', `${Math.sin(angle) * distance}px`);
                    star.style.animation = 'star-float 1.5s ease-out forwards';
                    document.body.appendChild(star);
                    
                    setTimeout(() => star.remove(), 1500);
                }, i * 50);
            }
        }

        function createConfetti() {
            const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A', '#98D8C8', '#FFD93D', '#6BCF7F'];
            
            for (let i = 0; i < 100; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * window.innerWidth + 'px';
                    confetti.style.top = '-10px';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animation = `confetti-fall ${Math.random() * 2 + 2.5}s ease-out forwards`;
                    confetti.style.animationDelay = Math.random() * 0.2 + 's';
                    document.body.appendChild(confetti);
                    
                    setTimeout(() => confetti.remove(), 4500);
                }, i * 12);
            }
        }

        function validateName(name) {
            return /^[A-Za-z .-]{2,30}$/.test(name.trim());
        }

        function handleStart() {
            try {
                userName = document.getElementById('nameInput').value.trim();
                const errorDiv = document.getElementById('nameError');
                
                if (!validateName(userName)) {
                    errorDiv.textContent = 'Please enter your name to begin.';
                    errorDiv.classList.remove('hidden');
                    document.getElementById('nameInput').classList.add('error');
                    return;
                }
                
                playRealisticFizz(1);
                showDisclaimer();
            } catch (error) {
                console.error('Start error:', error);
                alert('Something went wrong. Please refresh the page and try again.');
            }
        }

        function showDisclaimer() {
            const disclaimer = document.getElementById('disclaimer');
            disclaimer.classList.remove('hidden');
            
            setTimeout(() => {
                disclaimer.classList.add('show');
            }, 10);
            
            setTimeout(() => {
                disclaimer.classList.remove('show');
                disclaimer.classList.add('hide');
                
                setTimeout(() => {
                    disclaimer.classList.add('hidden');
                    disclaimer.classList.remove('hide');
                    startQuestions();
                }, 300);
            }, 2500);
        }

        function startQuestions() {
            currentQuestion = 0;
            answers = {};
            showQuestion();
            showScreen('questions');
        }

        function showQuestion() {
            const q = questions[currentQuestion];
            const progress = (currentQuestion / 5) * 90;
            
            document.getElementById('questionSpark').style.left = progress + '%';
            document.getElementById('questionCounter').textContent = `Question ${currentQuestion + 1} of 5`;
            document.getElementById('questionText').textContent = q.q;
            
            const backBtn = document.getElementById('backBtn');
            backBtn.style.display = currentQuestion > 0 ? 'block' : 'none';
            
            const container = document.getElementById('optionsContainer');
            container.innerHTML = '';
            
            q.opts.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = opt.text;
                btn.onclick = () => handleAnswer(opt.key);
                container.appendChild(btn);
            });
        }

        function handleAnswer(key) {
            try {
                answers[currentQuestion + 1] = key;
                
                const intensity = ((currentQuestion + 1) / 5) * 2.5;
                playRealisticFizz(intensity);
                
                if (currentQuestion < 4) {
                    currentQuestion++;
                    setTimeout(showQuestion, 400);
                } else {
                    document.getElementById('questionSpark').style.left = '100%';
                    setTimeout(() => {
                        showBlastAndResult();
                    }, 600);
                }
            } catch (error) {
                console.error('Answer error:', error);
                alert('Something went wrong. Please try again.');
            }
        }

        function showBlastAndResult() {
            const blastEl = document.getElementById('blast');
            blastEl.classList.remove('hidden');
            
            playRealisticBlast();
            createRealisticSparkles();
            createConfetti();
            
            setTimeout(() => {
                calculateResult();
                showResult();
                blastEl.classList.add('hidden');
                showScreen('result');
            }, 2000);
        }

        function goBackQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                delete answers[currentQuestion + 2];
                showQuestion();
            }
        }

        function calculateResult() {
            try {
                const scores = { P: 0, B: 0, L: 0, K: 0, J: 0, G: 0 };
                
                for (let i = 1; i <= 5; i++) {
                    const code = config.map[`Q${i}`][answers[i]];
                    scores[code] += config.weights[`Q${i}`];
                }
                
                const ranked = Object.entries(scores).sort((a, b) => b[1] - a[1]);
                let sweetCode = ranked[0][0];
                const topScore = ranked[0][1];
                const secScore = ranked[1][1];
                
                if (topScore - secScore <= 1) {
                    const topKey = ranked[0][0];
                    const secKey = ranked[1][0];
                    
                    for (const [a, b, w] of config.pairRules) {
                        const set = new Set([topKey, secKey]);
                        if (set.has(a) && set.has(b)) {
                            sweetCode = w;
                            break;
                        }
                    }
                    
                    if (topScore === secScore && config.q5TieBreak[answers[5]]) {
                        sweetCode = config.q5TieBreak[answers[5]];
                    }
                }
                
                const sweet = config.sweets[sweetCode];
                const lines = buildCustomLines(answers);
                resultData = { sweet, lines };
            } catch (error) {
                console.error('Calculate result error:', error);
                resultData = { 
                    sweet: config.sweets.L, 
                    lines: ['You completed the journey!', 'Your positivity shines through.'] 
                };
            }
        }

        function buildCustomLines(ans) {
            const picks = [];
            if (ans[1] === 'A') picks.push('You kept calm when things got loud — that\'s rare.');
            if (ans[1] === 'D') picks.push('You didn\'t just cope — you managed and moved.');
            if (ans[3] === 'C') picks.push('You turned mess into momentum (and a few laughs).');
            if (ans[3] === 'B') picks.push('You kept people fed and feelings safe.');
            if (ans[4] === 'A') picks.push('Your heart wants quiet — and it\'s allowed.');
            if (ans[4] === 'B') picks.push('You craved real support — that\'s honest.');
            if (ans[2] === 'D') picks.push('You protected your energy like a pro.');
            if (ans[2] === 'A') picks.push('You ran on low battery but still showed up.');
            if (ans[5] === 'C') picks.push('Humour was your survival kit — and it worked.');
            if (ans[5] === 'A') picks.push('You chose patience over panic — powerful.');
            return picks.slice(0, 2);
        }

        function showResult() {
            document.getElementById('userName').textContent = userName;
            
            const sweetImg = document.getElementById('sweetImage');
            sweetImg.crossOrigin = 'anonymous';
            sweetImg.src = resultData.sweet.image;
            
            sweetImg.onload = function() {
                console.log('✅ Sweet image loaded successfully');
            };
            
            sweetImg.onerror = function() {
                console.error('❌ Failed to load sweet image');
            };
            
            document.getElementById('resultSweet').textContent = `You're a ${resultData.sweet.name}!`;
            document.getElementById('resultTitle').textContent = resultData.sweet.title;
            document.getElementById('resultMessage').textContent = resultData.sweet.msg;
            
            const linesDiv = document.getElementById('customLines');
            linesDiv.innerHTML = '';
            resultData.lines.forEach(line => {
                const p = document.createElement('p');
                p.className = 'custom-line';
                p.textContent = line;
                linesDiv.appendChild(p);
            });
        }

        function showScreen(screen) {
            ['landing', 'questions', 'result'].forEach(s => {
                document.getElementById(s).classList.add('hidden');
            });
            document.getElementById(screen).classList.remove('hidden');
        }

        function retakeQuiz() {
            currentQuestion = 0;
            answers = {};
            cardImageBlob = null;
            document.getElementById('nameInput').value = '';
            showScreen('landing');
        }

        function showLoading(message = 'Loading...') {
            const loading = document.createElement('div');
            loading.id = 'loadingSpinner';
            loading.className = 'loading-spinner';
            loading.innerHTML = `
                <div class="spinner"></div>
                <div style="font-size: 18px; font-weight: 600;">${message}</div>
            `;
            document.body.appendChild(loading);
        }

        function hideLoading() {
            const loading = document.getElementById('loadingSpinner');
            if (loading) {
                loading.remove();
            }
        }

        async function downloadCard() {
            try {
                showLoading('Generating your card...');
                
                const card = document.getElementById('downloadCard');
                
                // Wait for images to load
                const images = card.getElementsByTagName('img');
                await Promise.all(Array.from(images).map(img => {
                    if (img.complete && img.naturalHeight !== 0) return Promise.resolve();
                    return new Promise((resolve) => {
                        img.onload = resolve;
                        img.onerror = resolve;
                        setTimeout(resolve, 3000);
                    });
                }));
                
                const canvas = await html2canvas(card, {
                    scale: 3,
                    backgroundColor: '#ffffff',
                    useCORS: true,
                    allowTaint: false,
                    logging: false,
                    imageTimeout: 0,
                    removeContainer: true
                });
                
                // Convert to blob for sharing
                cardImageBlob = await new Promise(resolve => canvas.toBlob(resolve, 'image/png', 1.0));
                
                // Also trigger download
                const link = document.createElement('a');
                const filename = `Diwali-${userName}-${resultData.sweet.name}.png`.replace(/\s+/g, '-');
                link.download = filename;
                link.href = canvas.toDataURL('image/png', 1.0);
                link.click();
                
                hideLoading();
                console.log('✅ Card downloaded successfully:', filename);
                return cardImageBlob;
            } catch (error) {
                console.error('❌ Download failed:', error);
                hideLoading();
                alert('Download failed. Please try again or take a screenshot.');
                return null;
            }
        }

        async function shareThisGift() {
            try {
                // Generate card image first if not already generated
                if (!cardImageBlob) {
                    showLoading('Preparing your card...');
                    cardImageBlob = await generateCardImage();
                    hideLoading();
                }
                
                if (!cardImageBlob) {
                    alert('Failed to generate card. Please try downloading instead.');
                    return;
                }
                
                // Show share options
                showShareOptions();
                
            } catch (error) {
                console.error('❌ Share error:', error);
                hideLoading();
                alert('Something went wrong. Please try downloading your card instead.');
            }
        }

        async function generateCardImage() {
            try {
                const card = document.getElementById('downloadCard');
                
                // Wait for images to load
                const images = card.getElementsByTagName('img');
                await Promise.all(Array.from(images).map(img => {
                    if (img.complete && img.naturalHeight !== 0) return Promise.resolve();
                    return new Promise((resolve) => {
                        img.onload = resolve;
                        img.onerror = resolve;
                        setTimeout(resolve, 3000);
                    });
                }));
                
                const canvas = await html2canvas(card, {
                    scale: 3,
                    backgroundColor: '#ffffff',
                    useCORS: true,
                    allowTaint: false,
                    logging: false
                });
                
                return await new Promise(resolve => canvas.toBlob(resolve, 'image/png', 1.0));
            } catch (error) {
                console.error('❌ Generate image error:', error);
                return null;
            }
        }

        function showShareOptions() {
            const shareText = `🎇 I have earned the title of "${resultData.sweet.name}" - ${resultData.sweet.title}! What about you? Light your cracker within this Diwali! 🪔\n\nVisit: https://makeeazy.in/diwali2025`;
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.85);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                padding: 20px;
                animation: fadeIn 0.3s;
            `;
            
            const isMobile = window.innerWidth <= 768;
            
            modal.innerHTML = `
                <div style="background: white; border-radius: 24px; padding: ${isMobile ? '32px 24px' : '40px'}; max-width: 450px; width: 100%; text-align: center; animation: slideUp 0.3s; box-shadow: 0 20px 60px rgba(0,0,0,0.4);">
                    <div style="font-size: 72px; margin-bottom: 16px;">🎁</div>
                    <h3 style="color: #32509F; margin-bottom: 12px; font-size: ${isMobile ? '26px' : '30px'}; font-weight: bold;">Share Your Gift!</h3>
                    <p style="color: #6B7280; margin-bottom: 24px; font-size: ${isMobile ? '16px' : '18px'}; line-height: 1.6;">
                        Choose how you'd like to share your Diwali card:
                    </p>
                    
                    <button id="shareWhatsApp" style="
                        background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
                        color: white;
                        border: none;
                        padding: ${isMobile ? '18px 28px' : '20px 32px'};
                        border-radius: 14px;
                        font-size: ${isMobile ? '18px' : '20px'};
                        font-weight: bold;
                        cursor: pointer;
                        width: 100%;
                        margin-bottom: 14px;
                        box-shadow: 0 4px 12px rgba(37, 211, 102, 0.4);
                        transition: all 0.3s;
                    " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                        <span style="font-size: 28px; vertical-align: middle;">📱</span> Share on WhatsApp
                    </button>
                    
                    <button id="shareInstagram" style="
                        background: linear-gradient(135deg, #E1306C 0%, #C13584 50%, #833AB4 100%);
                        color: white;
                        border: none;
                        padding: ${isMobile ? '18px 28px' : '20px 32px'};
                        border-radius: 14px;
                        font-size: ${isMobile ? '18px' : '20px'};
                        font-weight: bold;
                        cursor: pointer;
                        width: 100%;
                        margin-bottom: 14px;
                        box-shadow: 0 4px 12px rgba(225, 48, 108, 0.4);
                        transition: all 0.3s;
                    " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                        <span style="font-size: 28px; vertical-align: middle;">📸</span> Share on Instagram
                    </button>
                    
                    <button id="copyToClipboard" style="
                        background: white;
                        color: #32509F;
                        border: 2px solid #32509F;
                        padding: ${isMobile ? '16px 24px' : '18px 28px'};
                        border-radius: 14px;
                        font-size: ${isMobile ? '17px' : '19px'};
                        font-weight: 600;
                        cursor: pointer;
                        width: 100%;
                        margin-bottom: 14px;
                        transition: all 0.3s;
                    " onmouseover="this.style.background='#DDE6FF'" onmouseout="this.style.background='white'">
                        📋 Copy Message
                    </button>
                    
                    <button onclick="this.closest('div[style*=fixed]').remove();" style="
                        background: transparent;
                        color: #9CA3AF;
                        border: none;
                        padding: 12px;
                        font-size: 16px;
                        cursor: pointer;
                        width: 100%;
                    ">
                        Close
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Add event listeners
            document.getElementById('shareWhatsApp').onclick = () => {
                modal.remove();
                shareToWhatsApp(shareText);
            };
            
            document.getElementById('shareInstagram').onclick = () => {
                modal.remove();
                shareToInstagram(shareText);
            };
            
            document.getElementById('copyToClipboard').onclick = () => {
                copyToClipboard(shareText);
                modal.remove();
            };
            
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        async function shareToWhatsApp(text) {
            try {
                // Try Web Share API first (works on mobile with files)
                if (navigator.share && navigator.canShare) {
                    const file = new File([cardImageBlob], `Diwali-${userName}.png`, { type: 'image/png' });
                    const shareData = {
                        title: 'My Diwali Result',
                        text: text,
                        files: [file]
                    };
                    
                    if (navigator.canShare(shareData)) {
                        await navigator.share(shareData);
                        console.log('✅ Shared successfully with image');
                        return;
                    }
                }
            } catch (error) {
                console.log('Web Share API failed, using fallback:', error);
            }
            
            // Fallback: Download card + Open WhatsApp with text
            downloadCardFromBlob();
            setTimeout(() => {
                const whatsappUrl = `https://api.whatsapp.com/send?text=${encodeURIComponent(text)}`;
                window.open(whatsappUrl, '_blank');
            }, 500);
        }

        async function shareToInstagram(text) {
            // Instagram doesn't support URL sharing
            // Download card + Copy text + Show instructions
            downloadCardFromBlob();
            
            // Copy text to clipboard
            try {
                await navigator.clipboard.writeText(text);
            } catch (e) {
                console.error('Clipboard error:', e);
            }
            
            // Show Instagram instructions
            setTimeout(() => {
                showInstagramGuide();
            }, 500);
        }

        function downloadCardFromBlob() {
            if (!cardImageBlob) {
                console.error('No card image blob available');
                return;
            }
            
            const link = document.createElement('a');
            link.download = `Diwali-${userName}-${resultData.sweet.name}.png`.replace(/\s+/g, '-');
            link.href = URL.createObjectURL(cardImageBlob);
            link.click();
            URL.revokeObjectURL(link.href);
        }

        function showInstagramGuide() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.85);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10001;
                padding: 20px;
                animation: fadeIn 0.3s;
            `;
            
            const isMobile = window.innerWidth <= 768;
            
            modal.innerHTML = `
                <div style="background: white; border-radius: 24px; padding: ${isMobile ? '32px 24px' : '40px'}; max-width: 450px; width: 100%; text-align: center; animation: slideUp 0.3s;">
                    <div style="font-size: 80px; margin-bottom: 16px;">📸</div>
                    <h3 style="color: #E1306C; margin-bottom: 16px; font-size: ${isMobile ? '26px' : '30px'}; font-weight: bold;">Share on Instagram</h3>
                    <p style="color: #10B981; margin-bottom: 20px; font-size: ${isMobile ? '17px' : '19px'}; font-weight: 600;">
                        ✅ Card Downloaded<br>
                        ✅ Message Copied
                    </p>
                    <div style="background: #FEF3F2; border-left: 4px solid #E1306C; padding: 20px; border-radius: 12px; margin-bottom: 24px; text-align: left;">
                        <p style="color: #374151; font-size: ${isMobile ? '16px' : '17px'}; line-height: 1.8; margin: 0;">
                            <strong style="color: #E1306C; display: block; margin-bottom: 12px;">📱 How to share:</strong>
                            1️⃣ Open Instagram app<br>
                            2️⃣ Create new Story or Post<br>
                            3️⃣ Upload your card image<br>
                            4️⃣ Paste the copied caption
                        </p>
                    </div>
                    <button onclick="this.closest('div[style*=fixed]').remove();" style="
                        background: linear-gradient(135deg, #E1306C 0%, #C13584 50%, #833AB4 100%);
                        color: white;
                        border: none;
                        padding: ${isMobile ? '18px 32px' : '20px 36px'};
                        border-radius: 14px;
                        font-size: ${isMobile ? '18px' : '20px'};
                        font-weight: bold;
                        cursor: pointer;
                        width: 100%;
                        box-shadow: 0 4px 12px rgba(225, 48, 108, 0.4);
                    ">
                        Got it! 👍
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        async function copyToClipboard(text) {
            try {
                await navigator.clipboard.writeText(text);
                
                // Show toast notification
                const toast = document.createElement('div');
                toast.style.cssText = `
                    position: fixed;
                    bottom: 30px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: #10B981;
                    color: white;
                    padding: 18px 32px;
                    border-radius: 12px;
                    font-size: 17px;
                    font-weight: 600;
                    z-index: 10002;
                    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
                    animation: slideUp 0.3s;
                `;
                toast.textContent = '✅ Message copied to clipboard!';
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.style.animation = 'fadeOut 0.3s';
                    setTimeout(() => toast.remove(), 300);
                }, 2500);
                
                // Also download the card
                downloadCardFromBlob();
                
            } catch (error) {
                console.error('Clipboard error:', error);
                alert('Message copied! Your card has also been downloaded.');
            }
        }

        // Input validation
        document.getElementById('nameInput').addEventListener('input', function() {
            const btn = document.getElementById('startBtn');
            btn.disabled = this.value.trim().length < 2;
            document.getElementById('nameError').classList.add('hidden');
            this.classList.remove('error');
        });

        document.getElementById('nameInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && this.value.trim().length >= 2) {
                handleStart();
            }
        });

        // Preload all images on page load
        window.addEventListener('load', function() {
            console.log('✅ Page loaded successfully');
            preloadImages();
        });

        // Error handler
        window.addEventListener('error', function(e) {
            console.error('❌ Global error:', e.error);
        });

        // Unhandled promise rejection handler
        window.addEventListener('unhandledrejection', function(e) {
            console.error('❌ Unhandled promise rejection:', e.reason);
        });
    </script>
</body>
</html>
